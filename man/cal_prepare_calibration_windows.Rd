% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cal_prepare_calibration_windows.R
\name{cal_prepare_calibration_windows}
\alias{cal_prepare_calibration_windows}
\title{Create calibration windows between consecutive good calibrations}
\usage{
cal_prepare_calibration_windows(sensor_calibration_data_list)
}
\arguments{
\item{sensor_calibration_data_list}{Nested list from join_sensor_calibration_data()
organized by year and site-parameter combinations. Must include sensor_serial,
correct_calibration flags, and sensor_date_lead columns.}
}
\value{
Nested list structure (year -> site-parameter -> calibration chunks)
where each chunk contains sensor data between two consecutive good calibrations
from the same sensor. Chunks include slope_final and offset_final columns
determined by calibration quality. Chunks missing sonde data are excluded.
}
\description{
Segments joined sensor-calibration data into windows bounded by consecutive good
calibrations. The function handles complex interactions between bad calibrations
and sensor swaps by creating windows only when calibrations meet specific criteria
for valid back calibration analysis.

Windows are created by splitting data based on changes in sensor serial numbers
and then further segmenting by consecutive good calibrations. This approach ensures
that each window contains sensor data collected between two reliable calibration
points from the same sensor, enabling accurate drift detection and correction.

The function handles edge cases where bad calibrations occur between good ones,
sensor swaps interrupt calibration sequences, and missing calibration data.
Only windows with valid calibration endpoints are retained for analysis.
}
\details{
The segmentation process occurs in two stages:
\enumerate{
\item Split by sensor serial number changes to handle sensor swaps
\item Split by consecutive good calibrations within each sensor period
}

Final slope and offset values are assigned based on calibration quality, using
current calibration parameters for good calibrations and lagged parameters for
bad calibrations. This enables appropriate parameter selection for subsequent
drift correction analysis.

Special considerations apply to pH parameters which require additional preparation
to select appropriate calibration points before back calibration processing.

Additional considerations for data preparation:

Window creation must account for interactions between bad calibrations and sensor swaps.
A longer calibration window is only valid when:
\itemize{
\item The former good calibration and bad calibration use the same sensor serial
\item Both calibrations reference the same latter good calibration
}

pH parameters require special handling to select appropriate calibration points
(point 1 vs point 2) before proceeding with back calibration analysis.
}
\examples{
\dontrun{
joined_data <- join_sensor_calibration_data(sensor_list, calibration_data)
calibration_windows <- cal_prepare_calibration_windows(joined_data)
}

}
\seealso{
\code{\link[=cal_join_sensor_calibration_data]{cal_join_sensor_calibration_data()}}
}
